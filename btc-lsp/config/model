-- Syntax for this file here:
-- https://github.com/yesodweb/persistent/blob/master/docs/Persistent-entity-syntax.md

User
  nodePubKey NodePubKey
  latestNonce Nonce
  insertedAt UTCTime
  updatedAt UTCTime
  UniqueUser nodePubKey
  deriving Eq Show Generic

SwapIntoLn
  userId UserId
  fundInvoice (LnInvoice 'Fund)
  fundAddress (OnChainAddress 'Fund)
  refundAddress (OnChainAddress 'Refund)
  chanCapUser (Money 'Usr 'Ln 'Fund)
  chanCapLsp (Money 'Lsp 'Ln 'Fund)
  feeLsp (Money 'Lsp 'OnChain 'Gain)
  feeMiner (Money 'Lsp 'OnChain 'Loss)
  status SwapStatus
  expiresAt UTCTime
  insertedAt UTCTime
  updatedAt UTCTime
  UniqueSwapIntoLn fundInvoice
  deriving Eq Show Generic

Block
  height BlkHeight
  hash BlkHash
  -- Using BlockHash instead of BlockId as prev because we
  -- don't want to scan all blockchain. First block
  -- does not have previous block, but it's ok because
  -- we don't start from first block anyway. All monitored
  -- addresses are generated by lsp itself, so first block
  -- addresses will never happen.
  prev BlkPrevHash
  status BlkStatus
  insertedAt UTCTime
  updatedAt UTCTime
  UniqueBlock hash
  deriving Eq Show Generic

LnChan
  swapIntoLnId SwapIntoLnId
  fundingTxId (TxId 'Funding)
  fundingVout (Vout 'Funding)
  closingTxId (TxId 'Closing) Maybe
  numUpdates Word64
  status LnChanStatus
  insertedAt UTCTime
  updatedAt UTCTime
  UniqueLnChan fundingTxId fundingVout
  deriving Eq Show Generic
